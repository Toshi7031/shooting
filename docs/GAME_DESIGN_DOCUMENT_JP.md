# ゲームデザイン仕様書：Circle Breaker Survivors (v2.1 Final)

## 1. 概要
- **タイトル**: Circle Breaker Survivors
- **ジャンル**: ブロック崩し / サバイバー系ローグライク
- **エンジン**: Flutter + Flame
- **ステータス**: v2.1 実装進行中

## 2. コアメカニクス：Kinetic Charge (運動エネルギー蓄積)
プレイヤーの「反射テクニック」を火力に変換する基本システム。

* **基本ルール**: ボールが壁に衝突するたびに、ダメージ倍率が上昇する。
* **計算式**: `最終ダメージ = 基礎ダメージ * (1.0 + (Bounce回数 * 0.1))`
* **シナジー**: 貫通（Pierce）ステータスが高いと、敵にヒットしてもボールが消えずチャージを維持したまま次の攻撃に移れるため、結果的に火力が伸びる。

### コア（Core）の基本仕様
- **位置**: 画面中央（レスポンシブ対応）。
- **HP**: 100（初期値）。0になるとゲームオーバー。
- **攻撃**: **最も近い敵** を自動的に狙って（オートエイム）ボールを発射します。
- **弾薬（Loadout）**: 所持しているボール（アイテム）を順番に発射します。

## 3. 進行システム：Singularity Merge (シンギュラリティ・マージ)
戦況をひっくり返す「必殺技」としてのクラフトシステム。

* **発動条件**: ボールの所持数(Total Balls)が **100個以上** であること。
* **操作**: ショップ画面 (SHOP) の「交換枠」から手動で実行。
* **コスト**: 所持しているボール **100個** を消費（Loadoutから削除される）。フィールド上のボールは即座には消えないが、再生成権利を失う。
* **報酬**: 上位ティアである **Tier 2 (Awakened)** のボールを1個生成。

### 既存の進行要素
- **ウェーブシステム**: 敵はウェーブ単位で出現。すべての敵を倒すと次へ。
- **RPG要素**: 敵撃破でXP獲得、任意タイミングで物理/炎/冷気/攻撃速度/貫通/跳ね返りなどを強化。
- **アーティファクト**: 最大3枠。ショップで購入可能。
- **経済**: 敵ドロップのゴールドで、ボール購入、回復、強化を行う。

## 4. ボールデータ (Tier 1 & Tier 2)

### 共通仕様
* **Tier 1 (Normal)**: ショップで購入可能な通常弾。
* **Tier 2 (Awakened)**: マージ専用の「覚醒弾」。
* **ダメージ**: `(素材100個の合計攻撃力) * 1.5倍`

### A. 物理 (Physical)
**Tier 1: Iron Ball**
* 基本性能。コスト: 50G。

**Tier 2: Juggernaut Sphere**
* **コンセプト**: 物理制圧。
* **覚醒特性**: **Kinetic Charge 効率 3.0倍** (バウンスごとのダメージ上昇量が `+30%`)。
* **固有効果**: **Heavy Impact**
* **Stun**: **2%** の確率で敵を0.5秒スタンさせる。

### B. 回復 (Sustain)
**Tier 1: Vampire Orb**
* キル時回復。コスト: 250G。

**Tier 2: Blood Moon**
* **コンセプト**: ドレインタンク。
* **覚醒特性**: **Overheal → Shield** (HP満タン時の回復分をシールドに変換)。
* **固有効果**: **Crimson Trail** (通過した軌跡にダメージエリアを残し、HP吸収)。

### C. 範囲 (AoE)
**Tier 1: Blast Orb**
* ヒット時爆発。コスト: 150G。

**Tier 2: Supernova**
* **コンセプト**: 画面全体攻撃。
* **覚醒特性**: **Explosion Radius 2.0倍**。
* **固有効果**: **Afterburn** (爆発地点に3秒間の燃焼エリアを残しDoT付与)。

## 5. 敵システム：Rare Mods & Headhunter

### 基本敵
- **ブロックエネミー**: 通常の敵。
- **ボスエネミー**: 5ウェーブごとに出現。

### Rare敵 & Headhunter
Wave 3以降の「Rare敵」と、それを奪うアーティファクト。

**アーティファクト「Headhunter」所持時の変換効果:**
| 敵のMod (Enemy Mod) | Coreへの変換効果 (Buff Effect) |
| --- | --- |
| **Haste** (移動速度UP) | **Attack Speed +50%** (連射速度UP) |
| **Giant** (サイズ・HP UP) | **Ball Size 1.5倍** (当たり判定拡大) |
| **Enraged** (自爆ダメUP) | **Global Damage +50%** (火力UP) |
| **Armored** (被ダメ軽減) | **Damage Reduction 50%** (被ダメ軽減) |
| **Gravity Well** (ボール減速) | **Slow Aura** (Core周囲の敵を減速) |

**注: 同種のModは最大5つまで重複可能。6つ目を取得すると最も古い効果が破棄される。**

## 6. UI & 操作
* **メインHUD**: XPバー、HPバー、ウェーブ、ゴールド。
* **下部パネル**: UPGRADE, SHOP, MENU。
* **マージ操作**: SHOP画面から実行。

## 7. 技術要件 (Technical Requirements)
Flutter + Flame で大量オブジェクトを描画・処理するための必須実装。

1. **SpriteBatch**: 敵とボールの描画に使用し、Draw Callを削減する。
2. **Object Pooling**: `Ball` クラスおよび `Particle`（エフェクト）のインスタンスを再利用し、GCスパイクを回避する。
3. **画面/オーディオ**: フルスクリーン・レスポンシブ、`AudioManager` によるBGMループ再生と多重SE再生。
